<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç¾å›½ Top 60 åæ ¡äº¤äº’åœ°å›¾ - ç²¾å“ç‰ˆ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script src="us-states.js"></script>

    <style>
        :root { --primary-color: #2c3e50; --accent-color: #3498db; }
        body { background-color: #f0f2f5; margin: 0; font-family: 'Helvetica Neue', Arial, sans-serif; }
        
        .state-label-text {
            text-align: center !important;
            color: #2c3e50 !important;
            font-weight: 800 !important;
            font-size: 13px !important;
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
            white-space: nowrap !important;
            pointer-events: none !important;
            background: none !important;
            border: none !important;
            display: block !important;
        }

        .main-container {
            max-width: 1100px;
            margin: 30px auto;
            background: #ffffff;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
        }

        .header { text-align: center; margin-bottom: 20px; color: var(--primary-color); }
        .header h2 { font-weight: 800; letter-spacing: 1px; }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 14px;
            outline: none;
        }

        #map {
            height: 600px;
            width: 100%;
            border-radius: 10px;
            z-index: 1;
        }

        .u-popup { line-height: 1.5; font-size: 13px; min-width: 200px; }
        .u-title { font-weight: bold; font-size: 15px; color: var(--accent-color); margin-bottom: 5px; }
        .tag { display: inline-block; padding: 2px 5px; border-radius: 3px; font-size: 11px; color: white; margin-right: 5px; }
        .tag-us { background: #e74c3c; }
        .tag-qs { background: #f1c40f; color: #333; }

/* å¼¹çª—å†…éƒ¨è¡Œé—´è· */
.u-info-row {
    margin-bottom: 6px;
    line-height: 1.4;
}

/* è°·æ­Œå®æ™¯é“¾æ¥æ ·å¼ */
.street-view-btn {
    display: inline-block;
    background-color: #4285F4; /* Google Blue */
    color: white !important;
    padding: 6px 12px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 12px;
    font-weight: bold;
    transition: background 0.2s;
}

.street-view-btn:hover {
    background-color: #3367d6;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* å¼¹çª—åˆ†å‰²çº¿ */
hr {
    margin: 8px 0;
    opacity: 0.5;
}

#sidebar {
    flex: 1;
    height: 680px;
    background: #fdfdfd;
    border-radius: 10px;
    border: 1px solid #eee;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    padding: 15px;
    background: #f8f9fa;
    border-bottom: 1px solid #eee;
    border-radius: 10px 10px 0 0;
}

#university-list {
   flex: 1;           /* è‡ªåŠ¨å¡«å……å‰©ä½™é«˜åº¦ */
    overflow-y: auto;  /* å‡ºç°çºµå‘æ»šåŠ¨æ¡ */
    padding: 10px;
}

.rank-group-title {
    background: #eee;
    padding: 5px 10px;
    font-size: 12px;
    font-weight: bold;
    color: #666;
    margin: 10px 0 5px 0;
    border-radius: 4px;
}

.uni-item {
    padding: 8px 10px;
    margin: 2px 0;
    font-size: 13px;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
    border: 1px solid transparent;
}

.uni-item:hover { background: #eef7ff; }

.uni-item.selected {
    background: #e3f2fd;
    border-color: #3498db;
    color: #2980b9;
    font-weight: bold;
}

.uni-item.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#reset-btn {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

#reset-btn:hover {
    background: #f1b0b7;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#reset-btn:active {
    transform: translateY(1px);
}

/* å½“å­¦æ ¡é¡¹è¢«ç¦ç”¨æ—¶çš„æ ·å¼ */
.uni-item.disabled {
    opacity: 0.35;           /* å˜ç° */
    cursor: not-allowed;      /* é¼ æ ‡å˜æˆç¦æ­¢å›¾æ ‡ */
    pointer-events: none;     /* å½»åº•ç¦æ­¢ç‚¹å‡»äº‹ä»¶ */
    filter: grayscale(100%);  /* å½»åº•å»è‰²ï¼ˆå¯é€‰ï¼Œæ•ˆæœæ›´æ˜æ˜¾ï¼‰ */
}

.footer-consult {
    text-align: center;
    padding: 20px 0;
    margin-top: 30px;
    background-color: #ffffff;
    border-top: 1px solid #eaeaea;
    color: #2c3e50;
    font-size: 16px;
    letter-spacing: 0.5px;
    box-shadow: 0 -5px 15px rgba(0,0,0,0.03);
}

.footer-consult strong {
    color: #06188b; /* å¾®ä¿¡æ–‡å­—ç”¨çº¢è‰²å¼ºè°ƒ */
    background: #fff5f5;
    padding: 2px 8px;
    border-radius: 4px;
    border: 1px dashed #fab1a0;
    margin-left: 5px;
}

.data-source-note {
    text-align: center;
    font-size: 12px;
    color: #95a5a6;
    margin-top: 40px; /* ä¸ä¸Šæ–¹åœ°å›¾ä¿æŒè·ç¦» */
    margin-bottom: -20px; /* ç´§è´´ä¸‹æ–¹çš„å’¨è¯¢æ¡ */
    font-style: italic;
    letter-spacing: 0.3px;
}

/* ç¨å¾®ä¼˜åŒ–ä¸€ä¸‹ä¹‹å‰çš„å’¨è¯¢æ¡ï¼Œè®©ä¸¤è€…è¡”æ¥æ›´è‡ªç„¶ */
.footer-consult {
    text-align: center;
    padding: 25px 0;
    margin-top: 30px;
    background-color: #ffffff;
    border-top: 1px solid #f1f1f1;
    color: #2c3e50;
    font-size: 16px;
}
.compare-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.compare-table th {
    background-color: var(--primary-color);
    color: white;
    padding: 15px;
    text-align: center;
}

.compare-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    text-align: center;
    background: white;
}

.compare-table tr:nth-child(even) td {
    background-color: #fcfcfc;
}

.compare-table th:first-child, .compare-table td:first-child {
    text-align: left;
    font-weight: bold;
    background: #f8f9fa;
    width: 120px;
}

.compare-tag {
    font-weight: bold;
    color: var(--accent-color);
}

    </style>
</head>
<body>


<div class="main-container" style="display: flex; gap: 20px; max-width: 1400px;">
    <div style="flex: 3;">
        <div class="header">
            <h2>ğŸ“ ç¾å›½åæ ¡åœ°ç†ä½ç½®åŠ¨æ€çœ‹æ¿</h2>
        </div>
        <div class="controls">
            <select id="stateSelect" onchange="applyFilters()"><option value="all">æ‰€æœ‰åœ°åŒº (å…¨ç¾)</option></select>
            <select id="rankSelect" onchange="applyFilters()">
                <option value="60">æ’åèŒƒå›´: Top 60</option>
                <option value="30">æ’åèŒƒå›´: Top 30</option>
                <option value="10">æ’åèŒƒå›´: Top 10</option>
            </select>
        </div>
        <div id="map"></div>
    </div>

    <div id="sidebar">
        <div class="sidebar-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <strong>å­¦æ ¡åå½• (Top 60)</strong>
                <button id="reset-btn" onclick="resetSelection()">ä¸€é”®é‡ç½®</button>
            </div>
            <div id="selection-count" style="font-size: 12px; color: #666; margin-top: 5px;">å·²é€‰: 0/3</div>
        </div>
        <div id="university-list"></div>
    </div>
</div>

<div class="data-source-note">
    * æ’åæ•°æ®æ›´æ–°è‡³ 2025 å¹´å‘å¸ƒçš„æœ€æ–°ç‰ˆ 2026 U.S. News / 2026 QS ä¸–ç•Œå¤§å­¦æ¦œå•
</div>

<div class="footer-consult">
    ğŸš€ ç ”ç©¶ç”Ÿç•™å­¦å…¨çƒæ··ç”³å…è´¹å’¨è¯¢ï¼Œæ·»åŠ å¾®ä¿¡ï¼š<strong>wmcx123456</strong>
</div>

<div id="comparison-section" class="main-container" style="display: none; margin-top: 20px;">
    <div class="header">
        <h3>ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡æ¨ªå‘å¯¹æ¯”</h3>
        <p>å¯¹æ¯”å·²é€‰ä¸­çš„å­¦æ ¡æ•°æ®</p>
    </div>
    <div id="comparison-table-container">
        <table class="compare-table">
            <thead>
                <tr id="compare-header">
                    <th>æ ¸å¿ƒæŒ‡æ ‡</th>
                </tr>
            </thead>
            <tbody id="compare-body">
                </tbody>
        </table>
    </div>
</div>

<div style="text-align: center; padding: 20px 0; color: #bdc3c7; font-size: 10px;">
    Â© 2026 ç¾å›½åæ ¡äº¤äº’åœ°å›¾é¡¹ç›® | ç ”ç©¶ç”Ÿç•™å­¦å’¨è¯¢å¾®ä¿¡ï¼šwmcx123456
</div>

<script>
  // --- 1. æ•°æ®å®šä¹‰åŒº (å¿…é¡»æ”¾åœ¨æœ€å‰é¢) ---
    const universityData = [
        // --- Top 1-10 ---
    { name: "æ™®æ—æ–¯é¡¿å¤§å­¦ (Princeton)", state: "NJ", coords: [40.3431, -74.6551], usRank: 1, qsRank: 22, economy: "é¡¶å°–å­¦æœ¯ä¸ç”Ÿç‰©åˆ¶è¯åœˆ", companies: "J&J, Bristol Myers Squibb", safety: "A+ (æå®‰å…¨)", distance: "1h çº½çº¦/è´¹åŸ", google: "https://www.google.com/maps/search/Princeton+University" },
    { name: "éº»çœç†å·¥å­¦é™¢ (MIT)", state: "MA", coords: [42.3601, -71.0942], usRank: 2, qsRank: 1, economy: "å…¨çƒç¡¬ç§‘æŠ€ä¸åˆ›æŠ•å¿ƒè„", companies: "Google, Amazon, Moderna", safety: "B+ (å¸‚åŒºæ³¨æ„)", distance: "æ³¢å£«é¡¿å¸‚å†…", google: "https://www.google.com/maps/search/MIT" },
    { name: "å“ˆä½›å¤§å­¦ (Harvard)", state: "MA", coords: [42.3770, -71.1167], usRank: 3, qsRank: 4, economy: "æ³•å¾‹ã€é‡‘èä¸å…¨çƒé¢†è¢–æ‘‡ç¯®", companies: "Fidelity, Biogen", safety: "A- (å®‰ä¿æå¼º)", distance: "æ³¢å£«é¡¿å¸‚å†…", google: "https://www.google.com/maps/search/Harvard+University" },
    { name: "æ–¯å¦ç¦å¤§å­¦ (Stanford)", state: "CA", coords: [37.4275, -122.1697], usRank: 4, qsRank: 3, economy: "ç¡…è°·æ ¸å¿ƒï¼Œåˆ›ä¸šä¸æŠ€æœ¯é«˜åœ°", companies: "Meta, Google, Tesla", safety: "A (æ²»å®‰è‰¯å¥½)", distance: "45m æ—§é‡‘å±±", google: "https://www.google.com/maps/search/Stanford+University" },
    { name: "è€¶é²å¤§å­¦ (Yale)", state: "CT", coords: [41.3163, -72.9223], usRank: 5, qsRank: 23, economy: "é¡¶å°–æ•™è‚²ä¸åŒ»ç–—æ¢çº½", companies: "Yale New Haven Health", safety: "B- (æ ¡å¤–è°¨æ…)", distance: "1.5h çº½çº¦", google: "https://www.google.com/maps/search/Yale+University" },
    { name: "åŠ å·ç†å·¥å­¦é™¢ (Caltech)", state: "CA", coords: [34.1377, -118.1253], usRank: 6, qsRank: 10, economy: "èˆªç©ºèˆªå¤©ä¸åŸºç¡€ç‰©ç†ä¸­å¿ƒ", companies: "NASA, SpaceX", safety: "A (é«˜æ¡£ä½å®…åŒº)", distance: "20m æ´›æ‰çŸ¶", google: "https://www.google.com/maps/search/Caltech" },
    { name: "æœå…‹å¤§å­¦ (Duke)", state: "NC", coords: [36.0014, -78.9382], usRank: 7, qsRank: 61, economy: "ä¸‰è§’ç ”ç©¶å›­(RTP)ç”Ÿç‰©ä¸­å¿ƒ", companies: "IBM, Cisco, GSK", safety: "A- (é£æ™¯ä¼˜ç¾)", distance: "25m ç½—åˆ©", google: "https://www.google.com/maps/search/Duke+University" },
    { name: "çº¦ç¿°éœæ™®é‡‘æ–¯ (JHU)", state: "MD", coords: [39.3299, -76.6205], usRank: 8, qsRank: 32, economy: "å…¨çƒåŒ»å­¦ã€å…¬å«ä¸å›½é˜²å·¥ä¸š", companies: "NASA/APL, Under Armour", safety: "C (æ²»å®‰é£é™©é«˜ï¼Œå‘¨è¾¹å·´å°”çš„æ‘©æ²»å®‰å¤æ‚ï¼Œå­¦æ ¡æä¾› 24/7 è“è‰²æŠ¥è­¦æŸ±åŠæ ¡è­¦ä¼´è¡ŒæœåŠ¡ã€‚ä¸¤ä¸ªæ ¡åŒºæ²»å®‰å‡éœ€é«˜åº¦è­¦æƒ•ï¼ŒåŠ¡å¿…ä½¿ç”¨æ ¡å†…æŠ¤é€æœåŠ¡ã€‚)", distance: "1h åç››é¡¿DC", google: "https://www.google.com/maps/search/Johns+Hopkins+University" },
    { name: "å®¾å¤•æ³•å°¼äºšå¤§å­¦ (UPenn)", state: "PA", coords: [39.9522, -75.1932], usRank: 9, qsRank: 11, economy: "æ²ƒé¡¿å•†å­¦é™¢ï¼Œå…¨çƒé‡‘èæ”¯æŸ±", companies: "Vanguard, BlackRock", safety: "B (å¤§å­¦åŸå†…å®‰å…¨)", distance: "è´¹åŸå¸‚å†…", google: "https://www.google.com/maps/search/UPenn" },
    { name: "è¥¿åŒ—å¤§å­¦ (Northwestern)", state: "IL", coords: [42.0565, -87.6753], usRank: 10, qsRank: 50, note: "ä¸»æ ¡åŒºåœ¨åŸƒæ–‡æ–¯é¡¿(æå®‰å…¨)ï¼›åŒ»å­¦é™¢/æ³•å­¦é™¢åœ¨èŠåŠ å“¥å¸‚åŒº",economy: "ä¼ åª’ã€å¸‚åœºè¥é”€ä¸ç®¡ç†å’¨è¯¢", companies: "Abbott, Kraft Heinz", safety: "A (å¯Œè£•æ¹–è¾¹åŒº)", distance: "30m èŠåŠ å“¥ï¼ŒåŸƒæ–‡æ–¯é¡¿ä¸èŠåŠ å“¥å¸‚åŒºæœ‰æ ¡è½¦æ¥é©³", google: "https://www.google.com/maps/search/Northwestern+University" },

    // --- Top 11-20 ---
    { name: "å¸ƒæœ—å¤§å­¦ (Brown)", state: "RI", coords: [41.8268, -71.4025], usRank: 11, qsRank: 79, economy: "å¸¸æ˜¥è—¤äººæ–‡ã€è®¾è®¡ä¸ç§‘ç ”", companies: "Hasbro, Citizens Bank", safety: "B+ (å¸‚åŒºæ°›å›´)", distance: "1h æ³¢å£«é¡¿", google: "https://www.google.com/maps/search/Brown+University" },
    { name: "åº·å¥ˆå°”å¤§å­¦ (Cornell)", state: "NY", coords: [42.4485, -76.4735], usRank: 12, qsRank: 16, note: "ä¸»æ ¡åŒºåœ¨ä¼Šè¨å¡ï¼›Techå­¦é™¢ä½äºçº½çº¦å¸‚ç½—æ–¯ç¦å²›",economy: "ä¼Šè¨å¡æ ¡åŒºä¾§é‡å†œæ—å·¥ç¨‹ï¼›çº½çº¦æ ¡åŒºä¾§é‡è®¡ç®—æœºä¸åˆ›æŠ•", companies: "Intel, Corning", safety: "A (ä¸–å¤–æ¡ƒæº)", distance: "4h çº½çº¦", google: "https://www.google.com/maps/search/Cornell+University" },
    { name: "å“¥ä¼¦æ¯”äºšå¤§å­¦ (Columbia)", state: "NY", coords: [40.8075, -73.9626], usRank: 13, qsRank: 34, economy: "æ›¼å“ˆé¡¿é‡‘èã€ä¼ åª’ã€è”åˆå›½", companies: "Goldman, JP Morgan", safety: "B- (å¤§åŸå¸‚æ³¨æ„)", distance: "çº½çº¦å¸‚å†…", google: "https://www.google.com/maps/search/Columbia+University" },
    { name: "èŠåŠ å“¥å¤§å­¦ (UChicago)", state: "IL", coords: [41.7886, -87.5987], usRank: 14, qsRank: 13, economy: "é‡åŒ–é‡‘èä¸ç»æµå­¦å·…å³°", companies: "Citadel, United", safety: "C+ (åˆ©ç”¨æ ¡å›­ç­è½¦ï¼Œå‘¨è¾¹å¤æ‚ï¼Œæµ·å¾·å…¬å›­åŒºå‘¨è¾¹æ²»å®‰æ³¢åŠ¨å¤§ï¼Œå»ºè®®é¿å¼€å—ä¾§è¡—åŒºã€‚)", distance: "èŠåŠ å“¥å¸‚å†…", google: "https://www.google.com/maps/search/University+of+Chicago" },
    { name: "åŠ å·å¤§å­¦ä¼¯å…‹åˆ© (UCB)", state: "CA", coords: [37.8719, -122.2585], usRank: 15, qsRank: 12, economy: "ç¡…è°·äººæ‰åº“ï¼Œç§‘æŠ€åˆ›ä¸šé«˜åœ°", companies: "Tesla, Salesforce", safety: "C+ (æ³¨æ„æµæµªæ±‰)", distance: "20m æ—§é‡‘å±±", google: "https://www.google.com/maps/search/UC+Berkeley" },
    { name: "åŠ å·å¤§å­¦æ´›æ‰çŸ¶ (UCLA)", state: "CA", coords: [34.0689, -118.4452], usRank: 15, qsRank: 42, economy: "å½±è§†å¨±ä¹ã€å›½é™…å•†åŠ¡ã€åŒ»ç–—", companies: "Disney, Netflix", safety: "B+ (WestwoodåŒº)", distance: "LAå¸‚å†…", google: "https://www.google.com/maps/search/UCLA" },
    { name: "è±æ–¯å¤§å­¦ (Rice)", state: "TX", coords: [29.7174, -95.4018], usRank: 17, qsRank: 141, economy: "èƒ½æºä¸­å¿ƒã€ä¼‘æ–¯é¡¿åŒ»ç–—æ¢çº½", companies: "ExxonMobil, Shell", safety: "A (åšç‰©é¦†åŒº)", distance: "ä¼‘æ–¯é¡¿å¸‚å†…", google: "https://www.google.com/maps/search/Rice+University" },
    { name: "è¾¾ç‰¹èŒ…æ–¯ (Dartmouth)", state: "NH", coords: [43.7044, -72.2887], usRank: 18, qsRank: 243, economy: "é¡¶å°–å•†ç§‘é¢„å¤‡ã€æœ¬ç§‘æ•™è‚²", companies: "McKinsey, Bain", safety: "A+ (å…¨ç¾æœ€å®‰å…¨)", distance: "2.5h æ³¢å£«é¡¿", google: "https://www.google.com/maps/search/Dartmouth+College" },
    { name: "èŒƒå¾·å ¡å¤§å­¦ (Vanderbilt)", state: "TN", coords: [36.1447, -86.8027], usRank: 18, qsRank: 261, economy: "åŒ»ç–—ç®¡ç†ä¸­å¿ƒï¼ŒéŸ³ä¹ä¹‹åŸ", companies: "HCA Healthcare", safety: "B+ (å¸‚åŒºç¨³å®š)", distance: "çº³ä»€ç»´å°”", google: "https://www.google.com/maps/search/Vanderbilt+University" },
    { name: "åœ£æ¯å¤§å­¦ (Notre Dame)", state: "IN", coords: [41.7025, -86.2353], usRank: 20, qsRank: 249, economy: "å¼ºå¤§å¤©ä¸»æ•™æ ¡å‹ç½‘ï¼Œé‡‘èä¼šè®¡", companies: "Deloitte, Boeing", safety: "A+ (å®é™æ ¡å›­)", distance: "1.5h èŠåŠ å“¥", google: "https://www.google.com/maps/search/University+of+Notre+Dame" },

    // --- Top 21-40 ---
    { name: "å¯†æ­‡æ ¹å®‰å¨œå ¡ (UMich)", state: "MI", coords: [42.2781, -83.7382], usRank: 21, qsRank: 44, economy: "æ±½è½¦ã€æ™ºèƒ½åˆ¶é€ ä¸ç”Ÿå‘½ç§‘å­¦", companies: "Ford, GM, Toyota", safety: "A- (å®‰å…¨å‹å¥½)", distance: "45m åº•ç‰¹å¾‹", google: "https://www.google.com/maps/search/University+of+Michigan" },
    { name: "å¡å†…åŸºæ¢…éš† (CMU)", state: "PA", coords: [40.4432, -79.9428], usRank: 21, qsRank: 52, economy: "AIã€æœºå™¨äººã€æ— äººé©¾é©¶ä¹‹éƒ½", companies: "Google, Uber", safety: "B (å­¦æœ¯åŒº)", distance: "åŒ¹å…¹å ¡å¸‚å†…", google: "https://www.google.com/maps/search/Carnegie+Mellon+University" },
    { name: "åŸƒé»˜é‡Œå¤§å­¦ (Emory)", state: "GA", coords: [33.7925, -84.3240], usRank: 24, qsRank: 196, economy: "å…¨çƒå…¬å«ä¸è´¢å¯Œ500å¼ºé›†ç¾¤", companies: "Coca-Cola, Delta, CDC", safety: "B+ (å¯Œè£•ç¤¾åŒº)", distance: "15m äºšç‰¹å…°å¤§", google: "https://www.google.com/maps/search/Emory+University" },
    { name: "ä¹”æ²»åŸå¤§å­¦ (Georgetown)", state: "DC", coords: [38.9076, -77.0723], usRank: 24, qsRank: 301, note: "ä¸»æ ¡åŒºåœ¨ä¹”æ²»åŸï¼›æ³•å­¦é™¢æ ¡åŒºé è¿‘å›½ä¼šå±±(DCå¸‚ä¸­å¿ƒ)",economy: "æ”¿æ²»ã€æ³•å¾‹ã€æ™ºåº“æ¢çº½ï¼Œä¸»æ ¡åŒºä¾§é‡å¤–äº¤æ”¿æ²»ï¼›æ³•å­¦é™¢æ ¡åŒºæåˆ©äºæ³•å¾‹å®ä¹ ", companies: "World Bank, IMF", safety: "B+ (å¤–äº¤å®˜åŒº)", distance: "DCç‰¹åŒºå†…", google: "https://www.google.com/maps/search/Georgetown+University" },
    { name: "åç››é¡¿åœ£è·¯æ˜“æ–¯ (WashU)", state: "MO", coords: [38.6483, -90.3050], usRank: 24, qsRank: 176, economy: "ç”Ÿç‰©åˆ¶è¯ä¸é¡¶å°–åŒ»å­¦ç ”ç©¶", companies: "Bayer, Centene", safety: "B (å®‰ä¿ä¸¥å¯†)", distance: "åœ£è·¯æ˜“æ–¯", google: "https://www.google.com/maps/search/WashU" },
    { name: "å¼—å‰å°¼äºšå¤§å­¦ (UVA)", state: "VA", coords: [38.0336, -78.5080], usRank: 24, qsRank: 260, economy: "å…¬ç«‹å¸¸æ˜¥è—¤ï¼Œæ”¿å•†åæµåœˆ", companies: "Capital One, Hilton", safety: "A- (ä¼ ç»Ÿå®‰å…¨)", distance: "2h DC", google: "https://www.google.com/maps/search/UVA" },
    { name: "åŒ—å¡æ•™å ‚å±± (UNC)", state: "NC", coords: [35.9049, -79.0469], usRank: 27, qsRank: 155, economy: "ç”Ÿç‰©æŠ€æœ¯ã€è¯å­¦ç ”ç©¶æ ¸å¿ƒ", companies: "Quintiles, RTP", safety: "A- (å¤§å­¦åŸ)", distance: "25m ç½—åˆ©", google: "https://www.google.com/maps/search/UNC+Chapel+Hill" },
    { name: "å—åŠ å·å¤§å­¦ (USC)", state: "CA", coords: [34.0224, -118.2851], usRank: 28, qsRank: 125, economy: "å½±è§†ã€æ¸¸æˆã€ä¼ åª’ã€åºå¤§æ ¡å‹ç½‘", companies: "Hulu, Disney", safety: "C (æ ¡å¤–ä¸å®‰å…¨ï¼Œä½äº LA å¸‚ä¸­å¿ƒï¼Œå­¦æ ¡æä¾›å…è´¹ Lyft æ ¡å›­æœåŠ¡åŒºåŠä¸¥å¯†çš„å›´æ å®‰æ£€ã€‚)", distance: "LAå¸‚ä¸­å¿ƒ", google: "https://www.google.com/maps/search/USC" },
    { name: "åŠ å·å¤§å­¦åœ£åœ°äºšå“¥ (UCSD)", state: "CA", coords: [32.8801, -117.2340], usRank: 28, qsRank: 72, economy: "ç”Ÿç‰©åˆ¶è¯ä¸æ— çº¿ç”µé€šä¿¡é«˜åœ°", companies: "Qualcomm, Illumina", safety: "A (æåº¦ä¼˜ç¾)", distance: "20m åœ£åœ°äºšå“¥", google: "https://www.google.com/maps/search/UCSD" },
    { name: "å¾·å·å¥¥æ–¯æ±€ (UT Austin)", state: "TX", coords: [30.2849, -97.7341], usRank: 30, qsRank: 66, economy: "ç¡…å±±ï¼Œç§‘æŠ€å·¨å¤´è¿å…¥æ ¸å¿ƒ", companies: "Tesla, Oracle", safety: "B+ (æ´»è·ƒç¹å)", distance: "å¥¥æ–¯æ±€å¸‚å†…", google: "https://www.google.com/maps/search/UT+Austin" },
    { name: "ä½›ç½—é‡Œè¾¾å¤§å­¦ (UF)", state: "FL", coords: [29.6436, -82.3549], usRank: 30, qsRank: 215, economy: "ç©ºé—´ç§‘å­¦ã€ç°ä»£å†œæŠ€ç ”ç©¶", companies: "Info Tech, Infinite", safety: "A- (é˜³å…‰å¤§å­¦åŸ)", distance: "1.5h å¥¥å…°å¤š", google: "https://www.google.com/maps/search/University+of+Florida" },
    { name: "çº½çº¦å¤§å­¦ (NYU)", state: "NY", coords: [40.7295, -73.9965], usRank: 32, qsRank: 43, note: "ä¸»æ ¡åŒºåœ¨æ›¼å“ˆé¡¿åç››é¡¿å¹¿åœºï¼›Tandonå·¥ç¨‹å­¦é™¢åœ¨å¸ƒé²å…‹æ—",economy: "é‡‘èã€æ—¶å°šã€æ–‡åŒ–ã€åœ°æ ‡ç»æµ", companies: "Morgan Stanley, Vogue", safety: "B (æ›¼å“ˆé¡¿æ ¡åŒºè¾ƒå¼€æ”¾ï¼›å¸ƒé²å…‹æ—æ ¡åŒºéœ€æ³¨æ„æ™šé—´å®‰å…¨)", distance: "çº½çº¦å¸‚ä¸­å¿ƒ", google: "https://www.google.com/maps/search/NYU" },
    { name: "ä½æ²»äºšç†å·¥ (GT)", state: "GA", coords: [33.7756, -84.3963], usRank: 33, qsRank: 114, economy: "å—æ–¹ç§‘æŠ€æ¢çº½ã€ç‰©æµä¸­å¿ƒ", companies: "Microsoft, NCR", safety: "B (å¸‚åŒº)", distance: "äºšç‰¹å…°å¤§", google: "https://www.google.com/maps/search/Georgia+Tech" },
    { name: "åŠ å·å¤§å­¦æˆ´ç»´æ–¯ (UCD)", state: "CA", coords: [38.5382, -121.7617], usRank: 33, qsRank: 128, economy: "å†œä¸šç§‘å­¦ã€å…½åŒ»ã€ç”Ÿå‘½ç§‘å­¦", companies: "Bayer, Marrone", safety: "A (å•è½¦ä¹‹åŸ)", distance: "20m æ²™åŠ ç¼…åº¦", google: "https://www.google.com/maps/search/UC+Davis" },
    { name: "åŠ å·å¤§å­¦æ¬§æ–‡ (UCI)", state: "CA", coords: [33.6405, -117.8443], usRank: 33, qsRank: 232, economy: "åŠå¯¼ä½“ã€æ¸¸æˆå¼€å‘ã€é«˜ç§‘æŠ€å›­åŒº", companies: "Broadcom, Blizzard", safety: "A+ (å…¨ç¾æœ€å®‰å…¨)", distance: "45m LA", google: "https://www.google.com/maps/search/UC+Irvine" },
    { name: "åŠ å·å¤§å­¦åœ£å¡”èŠ­èŠ­æ‹‰ (UCSB)", state: "CA", coords: [34.4140, -119.8489], usRank: 33, qsRank: 178, economy: "ç‰©ç†ã€ææ–™ç§‘å­¦ã€å…‰å­¦ä¸­å¿ƒ", companies: "Raytheon, AppFolio", safety: "B+ (æ´¾å¯¹åŒºæ³¨æ„)", distance: "1.5h LA", google: "https://www.google.com/maps/search/UCSB" },
    { name: "å¨æ–¯åº·æ˜Ÿéº¦è¿ªé€Š (UW)", state: "WI", coords: [43.0766, -89.4125], usRank: 35, qsRank: 116, economy: "ç§‘ç ”ã€ç”Ÿç‰©ã€ä¿é™©ä¸šä¸­å¿ƒ", companies: "Epic Systems", safety: "A- (ä¼˜ç¾æ¹–åŒº)", distance: "1.5h å¯†å°”æ²ƒåŸº", google: "https://www.google.com/maps/search/UW+Madison" },
    { name: "ä¼Šåˆ©è¯ºä¼Šé¦™æ§Ÿ (UIUC)", state: "IL", coords: [40.1020, -88.2272], usRank: 35, qsRank: 69, economy: "è®¡ç®—æœºç¥æ ¡ã€åˆ¶é€ ä¸šä¸å†œä¸šå·¥ç¨‹", companies: "John Deere, Caterpillar", safety: "B+ (å¤§å­¦åŸä¸­å¿ƒ)", distance: "2.5h èŠåŠ å“¥", google: "https://www.google.com/maps/search/UIUC" },
    { name: "æ³¢å£«é¡¿å­¦é™¢ (BC)", state: "MA", coords: [42.3355, -71.1685], usRank: 35, qsRank: 630, note: "ä¸»æ ¡åŒºå»¶æŸ¥å°”æ–¯æ²³åˆ†å¸ƒï¼›åŒ»å­¦é™¢æ ¡åŒºåœ¨æ³¢å£«é¡¿South End",economy: "ä¼ ç»Ÿç²¾è‹±å•†ç§‘ã€ä¼šè®¡ã€é‡‘è", companies: "Bostoné‡‘èä¸š", safety: "B+ (ä¸»æ ¡åŒºé«˜æ¡£ä½å®…åŒºç¹åå®‰å…¨ï¼›åŒ»å­¦é™¢æ ¡åŒºå»ºè®®æ™šé—´ä½¿ç”¨æ ¡è½¦)", distance: "15m æ³¢å£«é¡¿", google: "https://www.google.com/maps/search/Boston+College" },
    { name: "å¡”å¤«èŒ¨å¤§å­¦ (Tufts)", state: "MA", coords: [42.4075, -71.1190], usRank: 35, qsRank: 344, economy: "å›½é™…å…³ç³»ã€æ–‡ç†å­¦é™¢çº§åˆ«æ•™è‚²", companies: "å’¨è¯¢åŠéè¥åˆ©æœºæ„", safety: "A (å®‰é™è¿‘éƒŠ)", distance: "15m æ³¢å£«é¡¿", google: "https://www.google.com/maps/search/Tufts+University" },

    // --- Top 41-60 ---
    { name: "ä¿„äº¥ä¿„å·ç«‹ (OSU)", state: "OH", coords: [40.0067, -83.0305], usRank: 41, qsRank: 196, economy: "åˆ¶é€ ä¸šæ¢çº½ã€æ•™è‚²ä¸­å¿ƒ", companies: "Honda, Nationwide", safety: "B (äººå£å¯†é›†)", distance: "å“¥ä¼¦å¸ƒå¸‚å†…", google: "https://www.google.com/maps/search/Ohio+State+University" },
    { name: "æ³¢å£«é¡¿å¤§å­¦ (BU)", state: "MA", coords: [42.3505, -71.1054], usRank: 41, qsRank: 108, economy: "ä¼ åª’ã€å•†åŠ¡ã€æ³¢å£«é¡¿éƒ½å¸‚ç»æµ", companies: "Wayfair, Liberty Mutual", safety: "B+ (ä¸»å¹²é“ç¹å)", distance: "æ³¢å£«é¡¿å¸‚å†…", google: "https://www.google.com/maps/search/Boston+University" },
    { name: "ç½—æ ¼æ–¯å¤§å­¦ (Rutgers)", state: "NJ", coords: [40.5003, -74.4474], usRank: 41, qsRank: 262, note: "ä¸»æ ¡åŒºåœ¨New Brunswickï¼›Newarkå’ŒCamdenä¸ºç‹¬ç«‹åˆ†æ ¡",economy: "ç”Ÿå‘½ç§‘å­¦èµ°å»Šã€åˆ¶è¯ä¸šæ ¸å¿ƒ", companies: "Johnson & Johnson", safety: "B (çº½ç“¦å…‹æ—ï¼Œæ³¨æ„ï¼šNewarkåˆ†æ ¡å‘¨è¾¹æ²»å®‰ç¯å¢ƒè¿œä¸å¦‚ä¸»æ ¡åŒº)", distance: "45m çº½çº¦", google: "https://www.google.com/maps/search/Rutgers+University" },
    { name: "åç››é¡¿å¤§å­¦ (UW-Seattle)", state: "WA", coords: [47.6553, -122.3035], usRank: 41, qsRank: 76, economy: "è¥¿é›…å›¾ç§‘æŠ€æ€»éƒ¨é›†ç¾¤", companies: "Amazon, Microsoft, Boeing", safety: "B- (æ³¨æ„æ ¡å¤–æ²»å®‰)", distance: "è¥¿é›…å›¾å¸‚å†…", google: "https://www.google.com/maps/search/University+of+Washington" },
    { name: "é©¬é‡Œå…°å¤§å­¦ (UMD)", state: "MD", coords: [38.9869, -76.9426], usRank: 44, qsRank: 164, economy: "å›½é˜²å·¥ä¸šã€å›½å®¶å®éªŒå®¤ã€ç½‘ç»œå®‰å…¨", companies: "Lockheed Martin, NSA", safety: "B- (è¿‘DC)", distance: "20m DC", google: "https://www.google.com/maps/search/UMD+College+Park" },
    { name: "å¾·å·å†œå·¥ (TAMU)", state: "TX", coords: [30.6187, -96.3365], usRank: 45, qsRank: 149, economy: "èƒ½æºçŸ³æ²¹ã€ç©ºé—´æŠ€æœ¯ã€å†œæ—", companies: "Halliburton, Chevron", safety: "A (ä¼ ç»Ÿå¤§å­¦åŸ)", distance: "1.5h ä¼‘æ–¯é¡¿", google: "https://www.google.com/maps/search/Texas+AM+University" },
    { name: "åˆ©å“ˆä¼Šå¤§å­¦ (Lehigh)", state: "PA", coords: [40.6073, -75.3789], usRank: 46, qsRank: 650, economy: "ä¼ ç»Ÿå·¥ç¨‹å¼ºæ ¡ã€è´¢åŠ¡ä¼šè®¡ä¸­å¿ƒ", companies: "Air Products", safety: "A- (å±±åœ°æ ¡å›­)", distance: "1.5h çº½çº¦", google: "https://www.google.com/maps/search/Lehigh+University" },
    { name: "æ™®æ¸¡å¤§å­¦ (Purdue)", state: "IN", coords: [40.4237, -86.9212], usRank: 46, qsRank: 101, economy: "èˆªç©ºèˆªå¤©ä¸åˆ¶é€ ä¸šé‡é•‡", companies: "Boeing, Cummins", safety: "A (æåº¦å®‰å…¨)", distance: "1h å°ç¬¬å®‰çº³", google: "https://www.google.com/maps/search/Purdue+University" },
    { name: "ç½—åˆ‡æ–¯ç‰¹å¤§å­¦ (UR)", state: "NY", coords: [43.1283, -77.6293], usRank: 47, qsRank: 271, economy: "å…‰å­¦ã€å£°ä¹ã€åŒ»å­¦ç§‘ç ”", companies: "Kodak (é—å€), URMC", safety: "B (æ ¡å†…å®‰ä¿å¼º)", distance: "1.5h æ°´ç‰›åŸ", google: "https://www.google.com/maps/search/University+of+Rochester" },
    { name: "ç»´å…‹æ£®æ— (Wake Forest)", state: "NC", coords: [36.1353, -80.2790], usRank: 47, qsRank: 800, economy: "ç²¾è‹±é‡‘èå•†ç§‘ç½‘ç»œ", companies: "Wells Fargo", safety: "A (åº„å›­å¼ç¯å¢ƒ)", distance: "1h å¤æ´›ç‰¹", google: "https://www.google.com/maps/search/Wake+Forest+University" },
    { name: "å¼—å‰å°¼äºšç†å·¥ (VT)", state: "VA", coords: [37.2284, -80.4234], usRank: 50, qsRank: 332, economy: "é‡å·¥ä¸šå·¥ç¨‹ã€å›½é˜²ç§‘ç ”åŸºåœ°", companies: "Raytheon", safety: "A (å®é™)", distance: "3h DC", google: "https://www.google.com/maps/search/Virginia+Tech" },
    { name: "å‡¯æ–¯è¥¿å‚¨ (CWRU)", state: "OH", coords: [41.5042, -81.6084], usRank: 51, qsRank: 265, economy: "å…¨çƒåŒ»ç–—é«˜åœ°ã€ç”Ÿç‰©å·¥ç¨‹", companies: "Cleveland Clinic", safety: "C+ (å‘¨è¾¹è¾ƒä¹±)", distance: "å…‹åˆ©å¤«å…°å¸‚å†…", google: "https://www.google.com/maps/search/Case+Western+Reserve+University" },
    { name: "å¨å»‰ç›ä¸½å­¦é™¢ (W&M)", state: "VA", coords: [37.2707, -76.7121], usRank: 53, qsRank: 801, economy: "å†å²ä¼ æ‰¿ã€æ³•å¾‹ã€æ”¿åºœæœåŠ¡ä¸­å¿ƒ", companies: "ç¾å›½è”é‚¦æ”¿åºœ", safety: "A+ (å¤é•‡å®‰å…¨)", distance: "1h é‡Œå£«æ»¡", google: "https://www.google.com/maps/search/College+of+William+and+Mary" },
    { name: "åŠ å·å¤§å­¦åœ£å…‹é²å…¹ (UCSC)", state: "CA", coords: [36.9916, -122.0608], usRank: 55, qsRank: 450, economy: "ç¡…è°·åèŠ±å›­ã€å¤©æ–‡ã€è®¡ç®—æœºç§‘å­¦", companies: "Google (åˆ†éƒ¨)", safety: "B+ (æ£®æ—ç¯å¢ƒ)", distance: "45m åœ£ä½•å¡", google: "https://www.google.com/maps/search/UC+Santa+Cruz" },
    { name: "ä¹”æ²»åç››é¡¿å¤§å­¦ (GWU)", state: "DC", coords: [38.8997, -77.0486], usRank: 56, qsRank: 380, economy: "å¤–äº¤ã€æ”¿æ²»ä¸­å¿ƒã€ç´§é‚»ç™½å®«", companies: "State Dept, IMF", safety: "B (å¸‚åŒº)", distance: "DCç‰¹åŒºå†…", google: "https://www.google.com/maps/search/GWU" },
    { name: "åº·æ¶…ç‹„æ ¼å¤§å­¦ (UConn)", state: "CT", coords: [41.8077, -72.2540], usRank: 57, qsRank: 460, economy: "ä½“è‚²å¼ºæ ¡ã€ä¿é™©ä¸šæ ¸å¿ƒåŒº", companies: "Aetna, The Hartford", safety: "A (å®‰é™éƒŠå¤–)", distance: "1.5h çº½çº¦/æ³¢å£«é¡¿", google: "https://www.google.com/maps/search/UConn" },
    { name: "ä½©ç€ä»£å› å¤§å­¦ (Pepperdine)", state: "CA", coords: [34.0416, -118.7095], usRank: 58, qsRank: 1000, economy: "å•†ç§‘ã€æ³•å¾‹ã€æµ·æ»¨åº¦å‡èƒœåœ°ç»æµ", companies: "å¨±ä¹äº§ä¸šã€ç§ä¼", safety: "A+ (é©¬é‡Œå¸ƒ)", distance: "45m LA", google: "https://www.google.com/maps/search/Pepperdine+University" },
    { name: "ä½›ç½—é‡Œè¾¾å·ç«‹ (FSU)", state: "FL", coords: [30.4419, -84.2985], usRank: 59, qsRank: 500, economy: "é¦–åºœæ”¿æ²»ã€ä¿é™©ä¸æ³•å¾‹", companies: "Florida Gov", safety: "B (å·åºœ)", distance: "2h æ°å…‹é€Šç»´å°”", google: "https://www.google.com/maps/search/Florida+State+University" },
    { name: "äºšåˆ©æ¡‘é‚£å·ç«‹ (ASU)", state: "AZ", coords: [33.4242, -111.9281], usRank: 60, qsRank: 195, economy: "å¾®ç”µå­åˆ›æ–°ã€ä¾›åº”é“¾ç®¡ç†", companies: "Intel, Honeywell", safety: "B (ç¹å)", distance: "15m å‡¤å‡°åŸ", google: "https://www.google.com/maps/search/ASU" },
    { name: "ç‰¹æ‹‰åå¤§å­¦ (UDel)", state: "DE", coords: [39.6781, -75.7506], usRank: 60, qsRank: 600, economy: "åŒ–å­¦å·¥ä¸šã€å…¬å¸æ³¨å†Œå…ç¨ä¸­å¿ƒ", companies: "DuPont, Chase", safety: "A- (å¤§å­¦åŸ)", distance: "1h è´¹åŸ", google: "https://www.google.com/maps/search/University+of+Delaware" }
];

const stateNameMapFull = {
    'Alabama': 'é˜¿æ‹‰å·´é©¬', 'Alaska': 'é˜¿æ‹‰æ–¯åŠ ', 'Arizona': 'äºšåˆ©æ¡‘é‚£', 'Arkansas': 'é˜¿è‚¯è‰²', 'California': 'åŠ åˆ©ç¦å°¼äºš',
    'Colorado': 'ç§‘ç½—æ‹‰å¤š', 'Connecticut': 'åº·æ¶…ç‹„æ ¼', 'Delaware': 'ç‰¹æ‹‰å', 'Florida': 'ä½›ç½—é‡Œè¾¾', 'Georgia': 'ä½æ²»äºš',
    'Hawaii': 'å¤å¨å¤·', 'Idaho': 'çˆ±è·å', 'Illinois': 'ä¼Šåˆ©è¯ºä¼Š', 'Indiana': 'å°ç¬¬å®‰çº³', 'Iowa': 'çˆ±è·å',
    'Kansas': 'å ªè¨æ–¯', 'Kentucky': 'è‚¯å¡”åŸº', 'Louisiana': 'è·¯æ˜“æ–¯å®‰é‚£', 'Maine': 'ç¼…å› ', 'Maryland': 'é©¬é‡Œå…°',
    'Massachusetts': 'é©¬è¨è¯¸å¡', 'Michigan': 'å¯†æ­‡æ ¹', 'Minnesota': 'æ˜å°¼è‹è¾¾', 'Mississippi': 'å¯†è¥¿è¥¿æ¯”', 'Missouri': 'å¯†è‹é‡Œ',
    'Montana': 'è’™å¤§æ‹¿', 'Nebraska': 'å†…å¸ƒæ‹‰æ–¯åŠ ', 'Nevada': 'å†…åè¾¾', 'New Hampshire': 'æ–°ç½•å¸ƒä»€å°”', 'New Jersey': 'æ–°æ³½è¥¿',
    'New Mexico': 'æ–°å¢¨è¥¿å“¥', 'New York': 'çº½çº¦', 'North Carolina': 'åŒ—å¡ç½—æ¥çº³', 'North Dakota': 'åŒ—è¾¾ç§‘ä»–', 'Ohio': 'ä¿„äº¥ä¿„',
    'Oklahoma': 'ä¿„å…‹æ‹‰è·é©¬', 'Oregon': 'ä¿„å‹’å†ˆ', 'Pennsylvania': 'å®¾å¤•æ³•å°¼äºš', 'Rhode Island': 'ç½—å¾·å²›', 'South Carolina': 'å—å¡ç½—æ¥çº³',
    'South Dakota': 'å—è¾¾ç§‘ä»–', 'Tennessee': 'ç”°çº³è¥¿', 'Texas': 'å¾·å…‹è¨æ–¯', 'Utah': 'çŠ¹ä»–', 'Vermont': 'ä½›è’™ç‰¹',
    'Virginia': 'å¼—å‰å°¼äºš', 'Washington': 'åç››é¡¿', 'West Virginia': 'è¥¿å¼—å‰å°¼äºš', 'Wisconsin': 'å¨æ–¯åº·æ˜Ÿ', 'Wyoming': 'æ€€ä¿„æ˜',
    'District of Columbia': 'åç››é¡¿DC', 'Puerto Rico': 'æ³¢å¤šé»å„'
};

const stateNameMap = {
    'CA': 'åŠ å·', 'NY': 'çº½çº¦', 'MA': 'é©¬è¨è¯¸å¡', 'TX': 'å¾·å·', 'PA': 'å®¾å·', 'IL': 'ä¼Šåˆ©è¯ºä¼Š',
    'NJ': 'æ–°æ³½è¥¿', 'CT': 'åº·æ¶…ç‹„æ ¼', 'MD': 'é©¬é‡Œå…°', 'NC': 'åŒ—å¡', 'RI': 'ç½—å¾·å²›',
    'NH': 'æ–°ç½•å¸ƒä»€å°”', 'TN': 'ç”°çº³è¥¿', 'IN': 'å°ç¬¬å®‰çº³', 'MI': 'å¯†æ­‡æ ¹', 'GA': 'ä½æ²»äºš',
    'MO': 'å¯†è‹é‡Œ', 'VA': 'å¼—å‰å°¼äºš', 'FL': 'ä½›ç½—é‡Œè¾¾', 'WI': 'å¨æ–¯åº·æ˜Ÿ', 'OH': 'ä¿„äº¥ä¿„',
    'WA': 'åç››é¡¿', 'AZ': 'äºšåˆ©æ¡‘é‚£', 'DE': 'ç‰¹æ‹‰å', 'DC': 'åç››é¡¿DC'
};

let selectedUnis = []; // è®°å½•ä¾§è¾¹æ é€‰ä¸­çš„å­¦æ ¡

  // --- 2. åœ°å›¾åˆå§‹åŒ– ---
    const map = L.map('map').setView([37.8, -96], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png').addTo(map);

    // åˆå§‹åŒ–èšåˆå›¾å±‚
    let markerLayer = L.markerClusterGroup({
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        disableClusteringAtZoom: 10 // ç¼©æ”¾åˆ°10çº§æ—¶è‡ªåŠ¨å±•å¼€æ‰€æœ‰æ°”æ³¡
    }).addTo(map);

    // --- 3. æ ·å¼ä¸æ¸²æŸ“å‡½æ•° ---
    function getStateStyle(feature) {
        const palette = ['#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', '#C7CEEA'];
        let hash = 0;
        const name = feature.properties.name || "";
        for (let i = 0; i < name.length; i++) {
            hash = name.charCodeAt(i) + ((hash << 5) - hash);
        }
        return {
            fillColor: palette[Math.abs(hash) % palette.length],
            weight: 1.5,
            opacity: 1,
            color: 'white',
            fillOpacity: 0.3
        };
    }

    function renderStateLayers() {
        if (typeof statesData === 'undefined') {
            console.error("statesData æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥ us-states.js æ˜¯å¦æ­£ç¡®åŠ è½½");
            return;
        }
        L.geoJson(statesData, {
            style: getStateStyle,
            onEachFeature: function(feature, layer) {
                const fullName = feature.properties.name;
                const chineseName = stateNameMapFull[fullName];
                if (chineseName) {
                    const center = layer.getBounds().getCenter();
                    L.marker(center, {
                        icon: L.divIcon({
                            className: 'state-label-text',
                            html: `<div>${chineseName}</div>`,
                            iconSize: [80, 20]
                        }),
                        interactive: false
                    }).addTo(map);
                }
            }
        }).addTo(map);
    }

    function getBubbleColor(state) {
        const colors = { 'CA': '#ff7800', 'NY': '#3388ff', 'MA': '#72af26', 'TX': '#e67e22', 'PA': '#9b59b6', 'IL': '#1abc9c' };
        return colors[state] || '#3498db';
    }

   function initStateFilter() {
        const stateSelect = document.getElementById('stateSelect');
        // æå–æ‰€æœ‰æœ‰å­¦æ ¡å­˜åœ¨çš„å·ç¼©å†™
        const states = [...new Set(universityData.map(u => u.state))].sort();
        
        states.forEach(state => {
            const option = document.createElement('option');
            option.value = state;

            // æŸ¥æ‰¾é€»è¾‘ï¼š
            // 1. å…ˆä»ç¼©å†™å¯¹åº”ä¸­æ–‡åï¼ˆstateNameMapï¼‰é‡Œæ‰¾
            // 2. å¦‚æœæ²¡æœ‰ï¼Œæ˜¾ç¤ºç¼©å†™æœ¬èº«
            const chineseName = stateNameMap[state] || state;
            
            option.textContent = `${chineseName} (${state})`; 
            stateSelect.appendChild(option);
        });
    }

    function applyFilters() {
        // 1. æ¸…é™¤ç°æœ‰æ°”æ³¡
        markerLayer.clearLayers();

        const selectedState = document.getElementById('stateSelect').value;
        const maxRank = parseInt(document.getElementById('rankSelect').value);

        // 2. ç­›é€‰æ•°æ®
        const filteredData = universityData.filter(u => {
            const matchState = (selectedState === 'all' || u.state === selectedState);
            const matchRank = u.usRank <= maxRank;
            return matchState && matchRank;
        });

        // 3. ç»˜åˆ¶æ–°æ°”æ³¡
        filteredData.forEach(u => {
            const marker = L.circleMarker(u.coords, {
                radius: 10,
                fillColor: getBubbleColor(u.state),
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            });

            const popupContent = `
                <div class="u-popup">
                    <div class="u-title">${u.name}</div>
                    <span class="tag tag-us">US News #${u.usRank}</span>
                    <span class="tag tag-qs">QS #${u.qsRank}</span><br>
                    <hr style="border:none; border-top:1px solid #eee; margin:10px 0;">
                    
                    <div class="u-info-row">
                        <b>ğŸ’¼ ç»æµç¯å¢ƒï¼š</b>${u.economy}
                    </div>
                    <div class="u-info-row">
                        <b>ğŸ¢ æ ¸å¿ƒå…¬å¸ï¼š</b>${u.companies || 'æš‚æ— æ•°æ®'}
                    </div>
                    <div class="u-info-row">
                        <b>ğŸ›¡ï¸ å®‰å…¨ç³»æ•°ï¼š</b>${u.safety}
                    </div>
                    <div class="u-info-row">
                        <b>ğŸ“ åŸå¸‚è·ç¦»ï¼š</b>${u.distance}
                    </div>
                    
                    <div style="margin-top:12px; text-align:center;">
                        <a href="${u.google}" target="_blank" class="street-view-btn">
                            ğŸ“ æŸ¥çœ‹è°·æ­Œåœ°å›¾å®æ™¯
                        </a>
                    </div>
                </div>
            `;
            marker.bindPopup(popupContent, { 
    autoClose: false,      // ç‚¹å‡»åœ°å›¾å…¶ä»–åœ°æ–¹æ—¶ä¸è‡ªåŠ¨å…³é—­æ°”æ³¡
    closeOnClick: false    // ç‚¹å‡»æ–°æ°”æ³¡æ—¶ä¸å…³é—­æ—§æ°”æ³¡
});
            markerLayer.addLayer(marker);
        });

        // 4. ç¼©æ”¾é€»è¾‘
        if (selectedState === 'all') {
            map.flyTo([37.8, -96], 4);
        } else if (filteredData.length > 0) {
            // æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ markerLayer.getBounds()
            map.flyToBounds(markerLayer.getBounds(), {
                padding: [50, 50],
                maxZoom: 7,
                duration: 1.5
            });
        }
    } // é—­åˆ applyFilters

// ==============ä¾§è¾¹æ ä¸“å±æ¨¡å—============================
function renderSidebar() {
    const container = document.getElementById('university-list');
    if (!container) return;
    container.innerHTML = '';
    
    for (let i = 0; i < 6; i++) {
        const start = i * 10 + 1;
        const end = (i + 1) * 10;
        
        const groupTitle = document.createElement('div');
        groupTitle.className = 'rank-group-title';
        groupTitle.innerText = `RANK ${start} - ${end}`;
        container.appendChild(groupTitle);

        const groupUnis = universityData.filter(u => u.usRank >= start && u.usRank <= end);
        
        groupUnis.forEach(u => {
            const item = document.createElement('div');
            item.className = 'uni-item';
            item.setAttribute('data-name', u.name); 
            item.innerHTML = `<small>#${u.usRank}</small> ${u.name}`;
            item.onclick = () => toggleUniversity(u, item);
            container.appendChild(item);
        });
    }
}

function toggleUniversity(u, element) {
    const index = selectedUnis.indexOf(u.name);
    
    // 1. æ›´æ–°é€‰ä¸­çŠ¶æ€
    if (index > -1) {
        selectedUnis.splice(index, 1);
        element.classList.remove('selected');
    } else {
        // ä¿®æ”¹ä¸ºä¸Šé™ 3
        if (selectedUnis.length >= 3) {
            alert("æœ€å¤šåªèƒ½åŒæ—¶å¯¹æ¯” 3 æ‰€å­¦æ ¡å“¦ï¼");
            return;
        }
        selectedUnis.push(u.name);
        element.classList.add('selected');
    }

    // 2. æ›´æ–°è®¡æ•°å™¨æ–‡å­—
    const countLabel = document.getElementById('selection-count');
    if (countLabel) countLabel.innerText = `å·²é€‰: ${selectedUnis.length}/3`;

    // 3. æ‰§è¡Œæ¸²æŸ“
    renderFocusedMarkers();
    updateComparisonTable(); // æ¯æ¬¡æ°”æ³¡æ›´æ–°æ—¶åŒæ­¥æ›´æ–°è¡¨æ ¼

    // 4. âœ¨ æ–°å¢ï¼šæ›´æ–°ä¾§è¾¹æ æ‰€æœ‰å­¦æ ¡çš„å¯ç‚¹å‡»çŠ¶æ€
    updateSidebarLockStatus();
}

function resetSelection() {
    // 1. æ¸…ç©ºå·²é€‰åå•æ•°ç»„
    selectedUnis = [];

    // 2. ç§»é™¤ä¾§è¾¹æ æ‰€æœ‰å­¦æ ¡çš„çŠ¶æ€
    document.querySelectorAll('.uni-item').forEach(item => {
        item.classList.remove('selected');
        item.classList.remove('disabled'); // âœ¨ å…³é”®ï¼šé‡ç½®æ—¶è§£é™¤â€œå˜ç°â€
    });

    // 3. é‡ç½®å·²é€‰æ•°é‡æ–‡å­— (åŒæ­¥ä¸º 3)
    const countLabel = document.getElementById('selection-count');
    if (countLabel) countLabel.innerText = `å·²é€‰: 0/3`;

    // 4. æ¢å¤é»˜è®¤æ°”æ³¡æ˜¾ç¤º
    renderFocusedMarkers();

    // 5. è§†é‡æ‹‰å›åˆ°å…¨ç¾
    map.flyTo([37.8, -96], 4, { duration: 1.5 });
    
    console.log("å·²é‡ç½®æ‰€æœ‰é€‰æ‹©ï¼Œæ¢å¤å…¨è§ˆæ¨¡å¼");
}

// âœ¨ è¡¥å…¨è¿™ä¸ªå‡½æ•°ï¼Œè§£å†³â€œæœªå®šä¹‰â€æŠ¥é”™
function updateSidebarLockStatus() {
    const allItems = document.querySelectorAll('.uni-item');
    const isFull = selectedUnis.length >= 3;

    allItems.forEach(item => {
        // å¦‚æœå·²ç»é€‰æ»¡äº†ï¼Œä¸”å½“å‰é¡¹æ²¡è¢«é€‰ä¸­ï¼Œå°±åŠ ä¸Š disabled æ ·å¼
        if (isFull && !item.classList.contains('selected')) {
            item.classList.add('disabled');
        } else {
            // å¦åˆ™ç§»é™¤ disabled æ ·å¼
            item.classList.remove('disabled');
        }
    });
}

// æ–°å¢ï¼šè®¡ç®—å¹¶ç¼©æ”¾åˆ°æ‰€æœ‰å·²é€‰å­¦æ ¡çš„ä¸­å¿ƒ
function updateSelectionView() {
    if (selectedUnis.length === 0) return;

    const selectedCoords = [];
    markerLayer.eachLayer(marker => {
        // æ£€æŸ¥è¿™ä¸ª Marker æ˜¯å¦åœ¨å·²é€‰åå•ä¸­
        const isSelected = selectedUnis.some(name => marker.getPopup().getContent().includes(name));
        if (isSelected) {
            selectedCoords.push(marker.getLatLng());
        }
    });

    if (selectedCoords.length === 1) {
        map.flyTo(selectedCoords[0], 8, { duration: 1.5 });
    } else if (selectedCoords.length > 1) {
        // åŒ…å«æ‰€æœ‰é€‰ä¸­ç‚¹çš„è¾¹ç•Œ
        const bounds = L.latLngBounds(selectedCoords);
        map.flyToBounds(bounds, { padding: [100, 100], duration: 1.5 });
    }
}

function renderFocusedMarkers() {
    // å…ˆæ¸…ç©ºåœ°å›¾ä¸Šçš„æ‰€æœ‰æ°”æ³¡
    markerLayer.clearLayers();

    // è·å–å½“å‰ä¸‹æ‹‰æ¡†çš„è¿‡æ»¤æ¡ä»¶ï¼ˆä¸ºäº†åœ¨æœªé€‰ä¸­å­¦æ ¡æ—¶æ¢å¤é»˜è®¤æ˜¾ç¤ºï¼‰
    const selectedState = document.getElementById('stateSelect').value;
    const maxRank = parseInt(document.getElementById('rankSelect').value);

    let displayData = [];

    if (selectedUnis.length > 0) {
        // --- èšç„¦æ¨¡å¼ï¼šåªæ˜¾ç¤ºé€‰ä¸­çš„å­¦æ ¡ ---
        displayData = universityData.filter(u => selectedUnis.includes(u.name));
    } else {
        // --- é»˜è®¤æ¨¡å¼ï¼šæ˜¾ç¤ºç¬¦åˆä¸‹æ‹‰æ¡†ç­›é€‰çš„æ‰€æœ‰å­¦æ ¡ ---
        displayData = universityData.filter(u => {
            const matchState = (selectedState === 'all' || u.state === selectedState);
            return matchState && u.usRank <= maxRank;
        });
    }

    // ç»˜åˆ¶æ°”æ³¡
    displayData.forEach(u => {
        const marker = L.circleMarker(u.coords, {
            radius: 12, // é€‰ä¸­æ¨¡å¼ä¸‹ç¨å¾®è°ƒå¤§ä¸€ç‚¹ï¼Œæ›´é†’ç›®
            fillColor: getBubbleColor(u.state),
            color: '#fff',
            weight: 3,
            opacity: 1,
            fillOpacity: 0.9
        });

        marker.bindPopup(createPopupHtml(u), { autoClose: false, closeOnClick: false });
        markerLayer.addLayer(marker);
        
        // å¦‚æœæ˜¯èšç„¦æ¨¡å¼ï¼Œè‡ªåŠ¨æ‰“å¼€æ°”æ³¡
        if (selectedUnis.length > 0) {
            setTimeout(() => marker.openPopup(), 300);
        }
    });

    // è‡ªåŠ¨è°ƒæ•´è§†é‡
    if (selectedUnis.length > 0) {
        const bounds = markerLayer.getBounds();
        map.flyToBounds(bounds, { padding: [100, 100], duration: 1 });
    } else {
        // å¦‚æœæ¸…ç©ºäº†é€‰æ‹©ï¼Œå›é€€åˆ°å…¨ç¾è§†é‡æˆ–å·è§†é‡
        applyFilters(); 
    }
}

// æå–ä¸€ä¸ªé€šç”¨çš„ Popup HTML ç”Ÿæˆå‡½æ•°ï¼Œä¿æŒä»£ç æ•´æ´
function createPopupHtml(u) {
    return `
        <div class="u-popup">
            <div class="u-title">${u.name}</div>
            <span class="tag tag-us">US News #${u.usRank}</span>
            <span class="tag tag-qs">QS #${u.qsRank}</span>
            <hr style="border:none; border-top:1px solid #eee; margin:10px 0;">
            <div class="u-info-row"><b>ğŸ’¼ ç»æµç¯å¢ƒï¼š</b>${u.economy}</div>
            <div class="u-info-row"><b>ğŸ¢ æ ¸å¿ƒå…¬å¸ï¼š</b>${u.companies || 'æš‚æ— æ•°æ®'}</div>
            <div class="u-info-row"><b>ğŸ›¡ï¸ å®‰å…¨ç³»æ•°ï¼š</b>${u.safety}</div>
            <div class="u-info-row"><b>ğŸ“ åŸå¸‚è·ç¦»ï¼š</b>${u.distance}</div>
            <div style="margin-top:12px; text-align:center;">
                <a href="${u.google}" target="_blank" class="street-view-btn">ğŸ“ æŸ¥çœ‹è°·æ­Œåœ°å›¾å®æ™¯</a>
            </div>
        </div>
    `;
}


    // --- 5. å¯åŠ¨ ---
    window.onload = function() {
    renderStateLayers(); // ç”»å·èƒŒæ™¯
    initStateFilter();   // å¡«å……ä¸‹æ‹‰èœå•
    applyFilters();      // åˆå§‹æ¸²æŸ“æ°”æ³¡
    renderSidebar();     // ã€æ–°å¢ã€‘ç”Ÿæˆä¾§è¾¹æ åˆ—è¡¨
}

function updateComparisonTable() {
    const section = document.getElementById('comparison-section');
    const headerRow = document.getElementById('compare-header');
    const body = document.getElementById('compare-body');

    // åªæœ‰é€‰ä¸­ 2 ä¸ªæˆ– 3 ä¸ªå­¦æ ¡æ—¶æ‰æ˜¾ç¤ºå¯¹æ¯”æ¨¡å—
    if (selectedUnis.length >= 2) {
        section.style.display = 'block';
        const selectedData = universityData.filter(u => selectedUnis.includes(u.name));

        // æ¸…ç©ºæ—§æ•°æ®
        headerRow.innerHTML = '<th>æ ¸å¿ƒæŒ‡æ ‡</th>';
        body.innerHTML = '';

        // ç”Ÿæˆè¡¨å¤´ï¼ˆæ ¡åï¼‰
        selectedData.forEach(u => {
            headerRow.innerHTML += `<th>${u.name.split(' (')[0]}</th>`; // åªæ˜¾ç¤ºä¸­æ–‡å
        });

        // å®šä¹‰è¦å¯¹æ¯”çš„ç»´åº¦
        const dimensions = [
            { label: 'U.S. News æ’å', key: 'usRank', prefix: '#' },
            { label: 'QS ä¸–ç•Œæ’å', key: 'qsRank', prefix: '#' },
            { label: 'åœ°ç†ä½ç½®/å·', key: 'state', prefix: '' },
            { label: 'è·ç¦»å¤§åŸå¸‚', key: 'distance', prefix: '' },
            { label: 'å°±ä¸šç¯å¢ƒ', key: 'economy', prefix: '' },
            { label: 'åä¼èµ„æº', key: 'companies', prefix: '' },
            { label: 'å®‰å…¨ç³»æ•°', key: 'safety', prefix: '' }
        ];

        // ç”Ÿæˆæ¯ä¸€è¡Œæ•°æ®
        dimensions.forEach(dim => {
            let rowHtml = `<tr><td>${dim.label}</td>`;
            selectedData.forEach(u => {
                let value = u[dim.key] || 'æš‚æ— æ•°æ®';
                // ç®€å•çš„ç¾åŒ–å¤„ç†
                if (dim.key === 'usRank' || dim.key === 'qsRank') {
                    value = `<span class="compare-tag">${dim.prefix}${value}</span>`;
                }
                rowHtml += `<td>${value}</td>`;
            });
            rowHtml += `</tr>`;
            body.innerHTML += rowHtml;
        });
        
        // è‡ªåŠ¨æ»šåŠ¨åˆ°å¯¹æ¯”åŒºåŸŸ
        section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    } else {
        section.style.display = 'none';
    }
};
</script>

</body>
</html>